<%- if flash[:error].nil?%>

$('#flash_feedback').html('<%= escape_javascript(flash[:message]) %>');
$('#flash_feedback').fadeIn("slow");
$('body').click(function(){$('#flash_feedback').fadeOut("slow")});
$('#save_form').dialog('close');

if($('#current_action_global').val()=="new"){
        $("#close_new_query").css("display", "none");
        $("#current_action").val("");
        $('#new_query_form').html('');
        $('#new_query_list').html('');
        $('#new_selection_form').html('');
        $('#new_selection_list').html('');
        $('#new_sorter_form').html('');
        $('#new_sorter_list').html('');
        $('#save_form').html('');
        $('#new_form').toggle('blind');
        $("#show_new_query").toggle('blind');
        $("#existing_query").toggle('blind');
        $('#show_queries').html('<%= escape_javascript(render(:partial => "queries/saved_query", :collection => QueryHeader.saved_queries)) %>');
}else{
        $("#edit_header").html('<%= escape_javascript(render(:partial => "queries/edit_query_header")) %>');
        $('#edit_query_form').html('<%= escape_javascript(render(:partial => "queries/new_query_criteria_form")) %>');
        $('#edit_query_list').html('<%= escape_javascript(render(:partial => "queries/query_criteria_list")) %>');
        $('#edit_selection_form').html('<%= escape_javascript(render(:partial => "queries/query_selection_form")) %>');
        $('#edit_selection_list').html('<%= escape_javascript(render(:partial => "queries/query_selection_list")) %>');
        $('#edit_sorter_form').html('<%= escape_javascript(render(:partial => "queries/query_sorter_form")) %>');
        $('#edit_sorter_list').html('<%= escape_javascript(render(:partial => "queries/query_sorter_list")) %>');
        $('#query_header_id').val('<%= escape_javascript("#{@query_header.id}") %>');
        $('#current_action_global').val('edit');
}


<%- else %>
$('#flash_message').html('<%= escape_javascript(flash[:error]) %>');
$('#flash_message').dialog( {
        modal: true,
        resizable: true,
        draggable :true,
        buttons: {
          Ok: function() {
            $(this).dialog('close');
          }
        }
      }

    );
    $('#flash_message').dialog('open');
<%- end %>